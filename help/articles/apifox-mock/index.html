<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-articles/apifox-mock/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Apifox Mock 功能全解析 | Apifox 帮助文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://apifox.com/help/articles/apifox-mock/"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="url" content="https://apifox.com"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Apifox Mock 功能全解析 | Apifox 帮助文档"><meta data-rh="true" name="description" content="前端的痛苦"><meta data-rh="true" property="og:description" content="前端的痛苦"><link data-rh="true" rel="icon" href="https://cdn.apifox.com/logo/apifox-logo-64.png"><link data-rh="true" rel="canonical" href="index.html"><link data-rh="true" rel="alternate" href="index.html" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="index.html" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Apifox 帮助文档" href="../../opensearch.xml"><link rel="stylesheet" href="https://cdn.apifox.com/mirror-www/help/assets/css/styles.845be0f2.css">
<link rel="preload" href="https://cdn.apifox.com/mirror-www/help/assets/js/runtime~main.856b1bcf.js" as="script">
<link rel="preload" href="https://cdn.apifox.com/mirror-www/help/assets/js/main.b8f811be.js" as="script">
</head>
<body class="navigation-with-keyboard theme-tars">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_VVze" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top flex justify-center navbar_GlWZ sticky top-0 z-40 w-full lg:backdrop-blur flex-none lg:z-50 bg-nearly-transparent dark:bg-transparent"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn navbar__toggle__btn_Wvd0" type="button"><svg class="navbar__toggle__menu_ncf9" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M85.333 256A42.667 42.667 0 0 1 128 213.333h768a42.667 42.667 0 1 1 0 85.334H128A42.667 42.667 0 0 1 85.333 256zm0 256A42.667 42.667 0 0 1 128 469.333h512a42.667 42.667 0 1 1 0 85.334H128A42.667 42.667 0 0 1 85.333 512zm0 256A42.667 42.667 0 0 1 128 725.333h768a42.667 42.667 0 1 1 0 85.334H128A42.667 42.667 0 0 1 85.333 768z"></path></svg></button><a class="navbar__brand" href="../../index.html"><div class="navbar__logo"><img src="https://cdn.apifox.com/logo/apifox-logo-64.png" alt="apifox" class="themedImage_RAmp themedImage--light_euby themeLogo_mjlK" height="24" width="24" style="width:24px;height:24px"><img src="https://cdn.apifox.com/logo/apifox-logo-64.png" alt="apifox" class="themedImage_RAmp themedImage--dark_tOZA themeLogo_mjlK" height="24" width="24" style="width:24px;height:24px"></div><b class="navbar__title text--truncate">Apifox 帮助文档</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="../../index.html">帮助文档</a><a class="navbar__item navbar__link" href="../../applications-and-plugins/idea/start.html">IDEA 插件</a><a class="navbar__item navbar__link" href="../../app/changelog/index.html">更新日志</a><a href="https://apifox666.feishu.cn/base/bascnA8ZHro9a3k73zpI93f5DKf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Road Map<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="iconExternalLink_vc86"><path d="M5.25 3.5c0-.322.261-.583.583-.583H10.5c.322 0 .583.261.583.583v4.667a.583.583 0 0 1-1.167 0V4.909l-6.004 6.004a.583.583 0 1 1-.825-.825l6.005-6.004H5.833A.583.583 0 0 1 5.25 3.5Z" fill="#101828" fill-opacity="0.24"></path></svg></a><a href="https://apifox-openapi.apifox.cn/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">开放 API<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="iconExternalLink_vc86"><path d="M5.25 3.5c0-.322.261-.583.583-.583H10.5c.322 0 .583.261.583.583v4.667a.583.583 0 0 1-1.167 0V4.909l-6.004 6.004a.583.583 0 1 1-.825-.825l6.005-6.004H5.833A.583.583 0 0 1 5.25 3.5Z" fill="#101828" fill-opacity="0.24"></path></svg></a><a href="../../../index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Apifox 官网<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="iconExternalLink_vc86"><path d="M5.25 3.5c0-.322.261-.583.583-.583H10.5c.322 0 .583.261.583.583v4.667a.583.583 0 0 1-1.167 0V4.909l-6.004 6.004a.583.583 0 1 1-.825-.825l6.005-6.004H5.833A.583.583 0 0 1 5.25 3.5Z" fill="#101828" fill-opacity="0.24"></path></svg></a><div class="navbar__item desktopDropdown dropdown--hoverable desktopDropdown_JWTf dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">下载</a><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="dropdownIcon_xPzk"><path d="M3.088 4.838a.583.583 0 0 1 .825 0L7 7.925l3.088-3.087a.583.583 0 0 1 .825.825l-3.5 3.5a.583.583 0 0 1-.825 0l-3.5-3.5a.583.583 0 0 1 0-.825Z" fill="#101828" fill-opacity="0.56"></path></svg><ul class="dropdown__menu"><li><a href="../../../index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">下载 Apifox<svg width="12" height="12" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="iconExternalLink_vc86"><path d="M5.25 3.5c0-.322.261-.583.583-.583H10.5c.322 0 .583.261.583.583v4.667a.583.583 0 0 1-1.167 0V4.909l-6.004 6.004a.583.583 0 1 1-.825-.825l6.005-6.004H5.833A.583.583 0 0 1 5.25 3.5Z" fill="#101828" fill-opacity="0.24"></path></svg></a></li><li><a href="https://plugins.jetbrains.com/plugin/20549-apifox-helper/versions" target="_blank" rel="noopener noreferrer" class="dropdown__link">下载 IDEA 插件<svg width="12" height="12" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="iconExternalLink_vc86"><path d="M5.25 3.5c0-.322.261-.583.583-.583H10.5c.322 0 .583.261.583.583v4.667a.583.583 0 0 1-1.167 0V4.909l-6.004 6.004a.583.583 0 1 1-.825-.825l6.005-6.004H5.833A.583.583 0 0 1 5.25 3.5Z" fill="#101828" fill-opacity="0.24"></path></svg></a></li><li><a class="dropdown__link" href="../../applications-and-plugins/browser-extensions/chrome.html">浏览器扩展</a></li></ul></div><div class="right-action_HoJ3"><div class="right-action__divider_wYf6"></div><div class="toggle_FZ2W"><button type="button" class="theme-toggle clean-btn toggleButton_OGEv toggleButtonDisabled_uxc6 toggleIcon_NaJ5" style="--theme-toggle__expand--duration:500ms" aria-label="Toggle theme" title="切换浅色/暗黑模式（当前为浅色模式）"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="1em" height="1em" fill="currentColor" class="theme-toggle__expand" viewBox="0 0 32 32"><clipPath id="navtheme-toggle__expand__cutout"><path d="M0-11h25a1 1 0 0017 13v30H0Z"></path></clipPath><g clip-path="url(#navtheme-toggle__expand__cutout)"><circle cx="16" cy="16" r="8.4"></circle><path d="M18.3 3.2c0 1.3-1 2.3-2.3 2.3s-2.3-1-2.3-2.3S14.7.9 16 .9s2.3 1 2.3 2.3zm-4.6 25.6c0-1.3 1-2.3 2.3-2.3s2.3 1 2.3 2.3-1 2.3-2.3 2.3-2.3-1-2.3-2.3zm15.1-10.5c-1.3 0-2.3-1-2.3-2.3s1-2.3 2.3-2.3 2.3 1 2.3 2.3-1 2.3-2.3 2.3zM3.2 13.7c1.3 0 2.3 1 2.3 2.3s-1 2.3-2.3 2.3S.9 17.3.9 16s1-2.3 2.3-2.3zm5.8-7C9 7.9 7.9 9 6.7 9S4.4 8 4.4 6.7s1-2.3 2.3-2.3S9 5.4 9 6.7zm16.3 21c-1.3 0-2.3-1-2.3-2.3s1-2.3 2.3-2.3 2.3 1 2.3 2.3-1 2.3-2.3 2.3zm2.4-21c0 1.3-1 2.3-2.3 2.3S23 7.9 23 6.7s1-2.3 2.3-2.3 2.4 1 2.4 2.3zM6.7 23C8 23 9 24 9 25.3s-1 2.3-2.3 2.3-2.3-1-2.3-2.3 1-2.3 2.3-2.3z"></path></g></svg></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_ZVXU flex items-center docsWrapper__Ftb"><div class="doc-page__inner docPage_njgP"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_ciaR" type="button"></button><main class="docMainContainer_aka8 docMainContainerEnhanced_ODBU"><div class="container padding-top--md padding-bottom--lg docItemWrapper_yEMf"><div class="row docItemInner_rg5W"><div class="col docItemCol_JCq7"><div class="docItemContainer_FeM2"><article><div class="tocCollapsible_UXw3 theme-doc-toc-mobile tocMobile_ErQB"><button type="button" class="clean-btn tocCollapsibleButton_Ki7f">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Apifox Mock 功能全解析</h1><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="前端的痛苦">前端的痛苦<a href="#%E5%89%8D%E7%AB%AF%E7%9A%84%E7%97%9B%E8%8B%A6" class="hash-link" aria-label="前端的痛苦的直接链接" title="前端的痛苦的直接链接">​</a></h2><p>作为前端，最痛苦的是什么时候？</p><p>每个迭代，需求文档跟设计稿都出来了，静态页面唰唰两天就做完了。可是做前端又不是简单地把后端吐出来的数据放到页面上就完了，还有各种前端处理逻辑啊。</p><p>后端接口还没出来，我就得边写代码边测前端效果，又没有真实数据。有人建议用 Mock 工具，可是每个接口都要自己写 Mock 规则，这得浪费多少时间呀。</p><p>等到后端好不容易把接口写出来了，一对接联调，好多字段的数据又跟我 Mock 的数据对不上，又得重新改代码。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180013-RVN8v4.png" width="300px" class="img_bRPe"><p>每个迭代都是一次折磨。</p><p>就是那种，明明知道这个地方整个团队都可以更有效率，但偏偏就是做不到的<strong>无力感</strong>。</p><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="黎明的希望">黎明的希望<a href="#%E9%BB%8E%E6%98%8E%E7%9A%84%E5%B8%8C%E6%9C%9B" class="hash-link" aria-label="黎明的希望的直接链接" title="黎明的希望的直接链接">​</a></h2><p>直到有一天，我遇到这个神器。我的效率提升了 100%。</p><p>我可以用最省力最优雅的方式得到我需要的 Mock 数据，甚至不需要任何配置。而且，联调时候曾经遇到的各种令人崩溃的前后端数据对接问题，统统不！见！了！</p><p>就是这个 ⬇️</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180040-PC3rjA.png" alt="Apifox" class="img_bRPe"></p><p>我研究了整整一周，越研究越是心惊。这个工具太强大，完全超出我的预期，就如《倚天屠龙记》里张无忌修炼的乾坤大挪移，练完一层，上面还有一层，每一层都是一片全新的天地。</p><p>我曾经以为，定接口什么的你们后端定就行了，跟我前端有什么关系。定好了吐数据给我就行了。</p><p>我曾经以为，写接口文档什么的完全是浪费时间，边写代码边改接口不好嘛。</p><p>直到我遇到这个神器，我才明白好的工作习惯能给我提升多少效率。</p><p>现在的我已经不一样了。我认为这款神器能够把全中国前端程序员的工作效率都提升一倍。我也希望在读这篇文章的你，能够好好把这款工具用起来。</p><p>以下还有 3000 字，阅读时长 5 ～ 10 分钟。如果你嫌读文字太麻烦，这里也有个视频，内容是一样的。</p><iframe src="https://player.bilibili.com/player.html?aid=382574576&amp;bvid=BV1BZ4y1B7tD&amp;cid=558386197&amp;page=1&amp;high_quality=1&amp;danmaku=0" scrolling="no" border="0" frameborder="no" framespacing="0" width="100%" height="550" allowfullscreen=""> </iframe><p>好，接下来我要发功了。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180121-RKILEa.png" width="300px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第一层-智能-mock">第一层：智能 Mock<a href="#%E7%AC%AC%E4%B8%80%E5%B1%82-%E6%99%BA%E8%83%BD-mock" class="hash-link" aria-label="第一层：智能 Mock的直接链接" title="第一层：智能 Mock的直接链接">​</a></h2><p>Apifox 是个 API 协作工具，用它来做 Mock 数据的基础也是 API 文档。在 Apifox 里维护的 API 可以生成好看的在线接口文档，也可以像 Postman 那样一键调试，像 JMeter 那样做测试，还可以直接 Mock 数据。不过今天我们只聊 <strong>Mock</strong>。</p><p>首先，你需要在 Apifox 里面创建一个接口，定义好<code>请求参数</code>和<code>返回数据结构</code>。</p><p>好了，保存。完成！</p><p>……………………</p><p>等会儿？Mock 呢？怎么就完成了？Mock 规则在哪儿写？</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/06/102905-nc9MoT.png" width="300px" class="img_bRPe"><p>真的就完成了。</p><p>Apifox 会自动启动一个本地的 Mock 服务，我复制一下 Apifox 自动生成的 Mock 地址，用浏览器打开看下效果。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/06/103000-P3zbqi.png" alt="Apifox" class="img_bRPe"></p><p>就是这么简单！就是这么方便！</p><p>什么！都不需要！配置！</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/06/103112-QaY9zM.png" width="300px" class="img_bRPe"><p>其实我们遇到的大部分 API 返回数据都是通用的，用户名、手机号、地址、邮箱、时间戳，等等等等。但是你要去写 Mock 规则就很麻烦。<strong>你要怎么生成一个看起来合理的中国人名？</strong></p><p>在 Apifox 里面，这变成了最简单的事情，甚至是完全无感的。只要写 API 文档的时候把返回的<strong>数据结构</strong>定义好，这个事情就完成了。Apifox 会根据<strong>字段名称</strong>智能生成 Mock 数据，<strong>不需要任何配置</strong>。</p><p>如接口返回的数据结构里某个字段名称叫<code>username</code>就会得到“程敏”“王宁”“<del>安慕希</del>”“<del>李玛璧</del>”。</p><p>字段名称叫<code>phone</code>，就会得到<code>15237829132</code>、<code>18907284633</code>。</p><p>字段名称叫<code>city</code>，就会得到<code>杭州市</code>、<code>高雄市</code>、<code>博尔塔拉蒙古自治州</code>。</p><p>甚至如果你的字段名称叫<code>icon</code>，就会返回一个<code>图片 URL</code>，打开就真的是一张 png 图片！</p><p>如果你们团队使用的是 Swagger 等其他工具管理 API 文档，也可以导入到 Apifox（Apifox 支持 20 多种格式数据导入，还可以设置<strong>定时自动导入</strong>），一样可以使用这个智能 Mock，一样是<strong>零配置</strong>自动生成所有 Mock 数据。</p><p>完全不用操心任何 Mock 数据配置的问题，只要接口定好了，Mock 数据就有了，我什么前端代码都能写。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/06/103156-vyXG8c.png" width="300px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第二层-自定义智能-mock-规则">第二层：自定义智能 Mock 规则<a href="#%E7%AC%AC%E4%BA%8C%E5%B1%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%99%BA%E8%83%BD-mock-%E8%A7%84%E5%88%99" class="hash-link" aria-label="第二层：自定义智能 Mock 规则的直接链接" title="第二层：自定义智能 Mock 规则的直接链接">​</a></h2><p>有的同学问，你这个都是预设死的吧？我怎么知道写什么参数名称你会给我 Mock 出什么数据来？好，这就是 Apifox Mock 功能的第二层：自定义智能 Mock 规则。</p><p>在 Apifox 里面内置了一整套 Mock 规则，当我们的返回字段名匹配上了其中的某条规则，就会根据对应规则生成随机值（Mock.js 语法规则）。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180254-SzH4XR.png" alt="Apifox 内置智能 Mock 规则" class="img_bRPe"></p><p>字段名称的匹配方式支持通配符和正则表达式，比如字段只要以 “url” 结尾，就会得到一个正确的网址；以 “mail” 打头，就会得到一个邮箱地址。</p><p>要是以 “time” 结尾，那还会自动根据字段的数据类型来 Mock 值：string 类型的话就返回一个 &#x27;yyyy-mm-dd hh:mm:ss&#x27; 格式时间；integer 类型的话就返回一个时间戳。是不是很智能？！</p><p>有内置规则，当然就可以自定义新规则。</p><p>比如我们公司的订单 id 是以 “DD” 打头的十位数字，我就可以新建一个 string 类型的规则，匹配规则写 “<!-- -->*<!-- -->orderid” ， mock 规则写一个正则表达式：@regexp(/DD\d{10}/)。这样，只要我任何一个接口返回字段是以 “orderid” 结尾，都会得到一个 “DD1284918414” 这样的返回值。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180401-4JrLGw.gif" width="50px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第三层-返回字段高级设置">第三层：返回字段高级设置<a href="#%E7%AC%AC%E4%B8%89%E5%B1%82-%E8%BF%94%E5%9B%9E%E5%AD%97%E6%AE%B5%E9%AB%98%E7%BA%A7%E8%AE%BE%E7%BD%AE" class="hash-link" aria-label="第三层：返回字段高级设置的直接链接" title="第三层：返回字段高级设置的直接链接">​</a></h2><p>有的同学说，你这个是比较通用的数据类型，可我还有很多没那么通用的类型，比如宠物店上架的宠物，有三种状态：可售、已售、待上架，要怎么 Mock 出来？</p><p>在 Apifox 里面，定义接口返回数据结构的时候每个字段都有一个“高级设置”的概念。比如我宠物的上架状态还可以定义为枚举，枚举可选值为（“available”，“sold”，“pending”）。如果接口这样定义了，那么 Mock 就会自动从这三个字符串里取值。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180418-lScXZe.png" alt="返回字段高级设置" class="img_bRPe"></p><p>这个字段高级设置里不止有枚举，还可以设置长度范围、正则规则等。如果字段类型是数字，还可以设置最大值最小值等。</p><p>如果你对 JSON Schema 比较熟的话，也可以直接写 Schema，那可定义空间就更大了。</p><p>而且我们要注意：这个时候我们设的其实不是 Mock 规则，而是接口返回值的数据结构定义，这个是会对接口调试的<strong>自动校验</strong>功能生效的，如果后端接口返回的数据不符合这里的设置，Apifox 会返回一个“<strong>数据结构校验失败</strong>”，就告诉后端你接口返回数据结构不对。</p><p>而我们的 Mock 数据也是根据这里的设置自动生成，不需要任何额外配置。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180435-4CKWSK.png" alt="怼后端专用图" class="img_bRPe"></p><p>爽不爽，可以直接甩一张截图去怼后端了。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180454-9KqN9W.png" width="300px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第四层-接口级自定义-mock">第四层：接口级自定义 Mock<a href="#%E7%AC%AC%E5%9B%9B%E5%B1%82-%E6%8E%A5%E5%8F%A3%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89-mock" class="hash-link" aria-label="第四层：接口级自定义 Mock的直接链接" title="第四层：接口级自定义 Mock的直接链接">​</a></h2><p>有的同学说，那我还有一种场景，比如我这个用户名字段，数据定义里其实是允许他输入任意字符串的，可是我 Mock 是需要一个真实姓名的，不能靠字段定义啊。</p><p>而且，你刚才演示的都是中国人名，我的客户都是欧美人怎么办。</p><p>啊，终于要针对特定接口设置一点点规则了。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180516-zVDBkX.png" alt="可选的 Mock 规则" class="img_bRPe"></p><p>在 Apifox 里，给接口定义数据结构的时候是可以给每个字段设置 Mock 规则的，而且直接就可以选一系列的常用 Mock 规则，常见的各种数据类型其实都齐全了。比如我需要一个外文人名，我就可以在这里写 @name，运行一下就会得到 “Larry Smith” “Susan Lee” 这样的英文名。</p><p>如果前面说的智能 Mock 满足不了你，在这里设置规则就可以覆盖掉内置规则。这里支持 Mock.js 和正则表达式，只要你能想到的规则，全都 Mock 得出来。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180538-JLqf45.png" alt="Mock 规则参考" class="img_bRPe"></p><p>而且 Apifox 支持 <strong>数据模型（Schema）</strong> 定义，不同的接口可以复用相同的数据模型，模型里定义的规则在所有引用它的接口里都会生效，不需要任何额外的配置。</p><p>一次 Mock，终身享受。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180612-QUmGpf.png" width="300px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第五层-高级-mock">第五层：高级 Mock<a href="#%E7%AC%AC%E4%BA%94%E5%B1%82-%E9%AB%98%E7%BA%A7-mock" class="hash-link" aria-label="第五层：高级 Mock的直接链接" title="第五层：高级 Mock的直接链接">​</a></h2><p>还有那么一些同学，他们说，希望能让我自己定义：根据不同的参数值，返回不同的数据。</p><p>比如我请求的参数<code>宠物ID</code> 为 <code>1</code> 就返回一个在售的宠物数据，如果<code>宠物ID</code> 为 <code>2</code> 就返回一个已售的宠物数据。我前端可以把几种状态的页面都做出来。</p><p>好吧，Apifox mock 的第五层就是为你准备的。</p><p>在 Apifox 的“接口管理” 有一个 “高级 Mock” 标签页。在这里我们可以添加“期望”。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180639-upyLJy.png" alt="Apifox 高级 Mock" class="img_bRPe"></p><p>一个期望就是指当你的请求包含某个参数值的时候，就返回特定的数据。</p><p>比如我设定我的<code>1</code>号宠物是在售的，<code>2</code>号宠物是已售出的，<code>3</code>号宠物是记录不存在的，DDD 号宠物是“ ID 格式不正确”的。我把这些返回值都设好。</p><p>之后，我发送的请求参数是<code>1</code>的时候，就返回一个在售的宠物信息；<code>2</code>返回一个已售的；<code>3</code>返回一个“404 not found”，<code>4</code>返回一个“Invalid Param”。</p><p>啊，简直能模拟出来一个后端服务器了！</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180657-Qaq7C9.png" width="100px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第六层-高级-mock-语法">第六层：高级 Mock 语法<a href="#%E7%AC%AC%E5%85%AD%E5%B1%82-%E9%AB%98%E7%BA%A7-mock-%E8%AF%AD%E6%B3%95" class="hash-link" aria-label="第六层：高级 Mock 语法的直接链接" title="第六层：高级 Mock 语法的直接链接">​</a></h2><p>你觉得这个 Mock 功能已经非常强大了是吧。我最开头提了张无忌，你知道张无忌的乾坤大挪移总共有几层吗？</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/180711-mjW4GZ.png" width="300px" class="img_bRPe"><p>我们进入高级 Mock 写期望的时候，鼠标放在这个支持 “Mock.js 语法”上会浮出来一段示例。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180731-H22Qzf.png" alt="高级 Mock 的语法示例" class="img_bRPe"></p><p>这个示例是讲什么的呢？我们可以在 Apifox 里面实际运行一下试试。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180747-lkFR9j.png" alt="以上示例的返回结果" class="img_bRPe"></p><p>它生成了一个 JSON 格式的数组！</p><p>总共有 20 组 id 和名字，比如你在前端要生成一个填满数据的二维表格，一次就能 Mock 一整套！只需要短短几行代码！</p><p>我们回来看这个语法示例，正常的 JSON 里面插入了大括号百分号包裹的两段 “for” 代码，它就是 JS 模板语法（Nunjucks 语法），可以使用它来生成复杂的数据结构！</p><p>不但支持 for 循环！还支持 if 分支！还支持正则表达式！还支持调用函数！</p><p>你说！是不是有我（加上 Apifox）就够了！还要后端做什么！</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180808-djAC1I.png" class="img_bRPe"></p><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="第七层-高级-mock-自定义脚本">第七层：高级 Mock 自定义脚本<a href="#%E7%AC%AC%E4%B8%83%E5%B1%82-%E9%AB%98%E7%BA%A7-mock-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC" class="hash-link" aria-label="第七层：高级 Mock 自定义脚本的直接链接" title="第七层：高级 Mock 自定义脚本的直接链接">​</a></h2><p>还有？？？</p><p>这是最新的 Apifox 2.1.7 才有的强大功能。</p><p>新版本的高级 Mock 增加了一个“脚本”的 Tab，这个高级 Mock 自定义脚本是做什么用的呢？</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180824-nNye5v.png" alt="高级 Mock 自定义脚本" class="img_bRPe"></p><p>我们来考虑一个实际的案例。我有一个“查询宠物列表”的 GET 接口，它的请求参数是 page 和 pageSize，取值是 6 和 10，含义就是我要查宠物列表的第 6 页，每页限定 10 条记录。这是个很常见的翻页场景。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180843-E9riQy.png" alt="我想要的" class="img_bRPe"></p><p>返回数据首先是一个数组，每一条是我查出来的这一页的一个宠物。下面还有一个 page 和 total，也就是当前页码和总计多少条记录。请求一下，返回的 Mock 数据就是一系列的宠物信息。</p><p>到下面的 page 字段，出现问题了：我请求的明明请求的是第 6 页的数据，你给我返回 page 是第 10 页算什么意思。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180902-V52Gqh.png" alt="我得到的" class="img_bRPe"></p><p>再翻翻页，新的问题又出现了：刚才还是总共 25 页呢，我一翻页就变成总共 40 页了？？？而且第 10 页的下一页是 22 页？</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180915-k26EmC.png" alt="翻到下一页" class="img_bRPe"></p><p>我希望 Mock 出来的数据是什么样的呢？应该是我请求的是第几页，返回来的数据就是第几页；然后总页数应该是固定的，不会因为我翻前翻后就变。</p><p>这时候我们就需要高级 Mock 的自定义脚本了。</p><p>在自定义脚本界面的右侧有一段示例代码，我们仔细读一下。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180930-DQpxk1.png" class="img_bRPe"></p><ol><li>通过 <code>fox.mockResponse.json()</code> 获取系统自动生成的 JSON 数据，赋值给变量 responseJson。</li><li>通过 <code>fox.mockRequest.getParam(&#x27;page&#x27;)</code> 获取实际请求参数 page，赋值给变量 responseJson 里的 page 字段。</li><li>把 responseJson 的 total 字段重写为 120。</li><li>通过 <code>fox.mockResponse.setBody(responseJson)</code> 把修改后的变量 responseJson 设置到的 mockResponse 里面，这样就修改了系统返回的 JSON 数据。</li></ol><p>这样，我请求的是第几页，返回的就也是对应的第几页，然后总页数是保持 12 不变（120 除以每页 10 个）。</p><p><img loading="lazy" src="https://cdn.apifox.com/markdown-img/202204/02/180957-MtpRHp.png" class="img_bRPe"></p><p>这个自定义脚本就可以做很多事情了，比如我需要根据用户的性别是男是女 Mock 出返回的不同头像；或者先 Mock 出出生日期，然后用出生日期拼装成对应的身份证号等等，可以让我们 Mock 出来的数据彼此吻合。</p><p>自定义脚本可以操作的对象就是这个 <code>fox.mockRequest</code> 和 <code>fox.mockResponse</code>，可以获取请求参数、Header、Cookie，修改响应 Body、HTTP 状态码等，甚至响应的延时都可以自定义。</p><p>你就说牛不牛吧！</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/181015-nEWaNn.png" width="300px" class="img_bRPe"><h2 class="anchor anchorWithStickyNavbar_v9Sm" id="赶紧去下载吧">赶紧去下载吧<a href="#%E8%B5%B6%E7%B4%A7%E5%8E%BB%E4%B8%8B%E8%BD%BD%E5%90%A7" class="hash-link" aria-label="赶紧去下载吧的直接链接" title="赶紧去下载吧的直接链接">​</a></h2><p>Apifox Mock 功能的七层天梯，打完收功。</p><p>如果你是个前端，并且读到了这里，我觉得你应该鼓一下掌。</p><p>Apifox 的 Mock 功能完全值得你点一下<strong>阅读原文</strong>然后去下载。其他的 API 和 Mock 工具你全都可以扔掉了。</p><p>记得要下载<code>Apifox</code>桌面版使用，WEB 版目前还不支持 Mock 功能。</p><p>最后提醒一下，Mock 只是 Apifox 的功能中的一小部分。<strong>Apifox = Postman + Swagger + Mock + Jmeter</strong>，它的功能远不止这篇文章里的这些。</p><img loading="lazy" alt="表情包" src="https://cdn.apifox.com/markdown-img/202204/02/181031-oipCFc.png" width="300px" class="img_bRPe"></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"></nav></div></div><div class="col col--3 tocContainer_k4ct"><div class="tableOfContents_FTEW theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents_vQkl 1234"><li><a href="#%E5%89%8D%E7%AB%AF%E7%9A%84%E7%97%9B%E8%8B%A6" class="table-of-contents__link toc-highlight">前端的痛苦</a></li><li><a href="#%E9%BB%8E%E6%98%8E%E7%9A%84%E5%B8%8C%E6%9C%9B" class="table-of-contents__link toc-highlight">黎明的希望</a></li><li><a href="#%E7%AC%AC%E4%B8%80%E5%B1%82-%E6%99%BA%E8%83%BD-mock" class="table-of-contents__link toc-highlight">第一层：智能 Mock</a></li><li><a href="#%E7%AC%AC%E4%BA%8C%E5%B1%82-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%99%BA%E8%83%BD-mock-%E8%A7%84%E5%88%99" class="table-of-contents__link toc-highlight">第二层：自定义智能 Mock 规则</a></li><li><a href="#%E7%AC%AC%E4%B8%89%E5%B1%82-%E8%BF%94%E5%9B%9E%E5%AD%97%E6%AE%B5%E9%AB%98%E7%BA%A7%E8%AE%BE%E7%BD%AE" class="table-of-contents__link toc-highlight">第三层：返回字段高级设置</a></li><li><a href="#%E7%AC%AC%E5%9B%9B%E5%B1%82-%E6%8E%A5%E5%8F%A3%E7%BA%A7%E8%87%AA%E5%AE%9A%E4%B9%89-mock" class="table-of-contents__link toc-highlight">第四层：接口级自定义 Mock</a></li><li><a href="#%E7%AC%AC%E4%BA%94%E5%B1%82-%E9%AB%98%E7%BA%A7-mock" class="table-of-contents__link toc-highlight">第五层：高级 Mock</a></li><li><a href="#%E7%AC%AC%E5%85%AD%E5%B1%82-%E9%AB%98%E7%BA%A7-mock-%E8%AF%AD%E6%B3%95" class="table-of-contents__link toc-highlight">第六层：高级 Mock 语法</a></li><li><a href="#%E7%AC%AC%E4%B8%83%E5%B1%82-%E9%AB%98%E7%BA%A7-mock-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC" class="table-of-contents__link toc-highlight">第七层：高级 Mock 自定义脚本</a></li><li><a href="#%E8%B5%B6%E7%B4%A7%E5%8E%BB%E4%B8%8B%E8%BD%BD%E5%90%A7" class="table-of-contents__link toc-highlight">赶紧去下载吧</a></li></ul></div></div></div></div></main></div></div></div>
<script src="https://cdn.apifox.com/mirror-www/help/assets/js/runtime~main.856b1bcf.js"></script>
<script src="https://cdn.apifox.com/mirror-www/help/assets/js/main.b8f811be.js"></script>
</body>
</html>